<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSS Census</title>
    <meta name="author" content="Justin">
    <meta name="description" content="">

    <!-- Tailwind -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css?family=Karla:400,700&display=swap');

        .font-family-karla {
            font-family: karla;
        }
    </style>

    <!-- Graph 1 CSS and Script links -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin="anonymous"></script>
</head>


<body class="bg-white font-family-karla">
    <!-- Top Bar Nav -->
    <nav class="w-full py-4 bg-blue-900 shadow">
        <div class="w-full container mx-auto flex flex-wrap items-center justify-between">
            <nav>
                <ul class="flex items-center justify-between font-bold text-sm text-white uppercase no-underline">
                    <li><a class="hover:text-gray-200 hover:underline px-4" href="index.html">Results</a></li>
                    <li><a class="hover:text-gray-200 hover:underline px-4" href="graphs.html">Graphs</a></li>
                </ul>
            </nav>
        </div>
    </nav>
    
    <div class="flex justify-center">
        <div class="mb-3 my-6 xl:w-96">

            <!-- Dropdown for language selection -->
            <label for="language-select">Choose a language:</label>
            <select name="language" id="language-select" onchange="update()" class="form-select appearance-none 
                block
                w-full
                px-3
                py-1.5
                my-4
                text-base
                font-normal
                text-gray-700
                bg-white bg-clip-padding bg-no-repeat
                border border-solid border-gray-300
                rounded
                transition
                ease-in-out
                m-0
                focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" aria-label="Default select">
                <option value="" selected disabled hidden>--Select an Option--</option>
                <option value="Python">Python</option>
                <option value="C#">C#</option>
                <option value="JavaScript">JavaScript</option>
                <option value="Java">Java</option>
                <option value="Go">Go</option>
                <option value="Ruby">Ruby</option>
                <option value="C++">C++</option>
                <option value="TypeScript">TypeScript</option>
                <option value="PHP">PHP</option>
                <option value="C">C</option>
                <option value="HTML">HTML</option>
                <option value="CSS">CSS</option>
                <option value="Jupyter">Jupyter</option>
                <option value="Shell">Shell</option>
                <option value="Objective-C">Objective-C</option>
                <option value="All">All</option>
            </select>

            <!-- Dropdown for category selection -->
            <label for="category-select">Choose a Category:</label>
            <select name="category" id="category-select" onload="storedValue()" onchange="update()" class="form-select appearance-none 
                block
                w-full
                px-3
                py-1.5
                my-4
                text-base
                font-normal
                text-gray-700
                bg-white bg-clip-padding bg-no-repeat
                border border-solid border-gray-300
                rounded
                transition
                ease-in-out
                m-0
                focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" aria-label="Default select">
                <option value="" selected disabled hidden>--Select an Option--</option>
                <option value="contributor">Contributors</option>
                <option value="commit">Commits</option>
                <option value="project">Project</option>
                <!-- <option value="all">All</option> -->
            </select>
            <button
                onclick="showGraphs()"
                type="button"
                data-mdb-ripple="true"
                data-mdb-ripple-color="light"
                class="inline-block px-6 py-2.5 bg-blue-600 text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out"
            >Generate</button>
        </div>
    </div>

    <!-- Graph 1_Contributor -->

    <div id="contributor" class="flex flex-col items-center w-full my-10">                
        <article class="flex flex-row shadow w-full md:w-3/3">                 
            <a href="#" class="px-6 hover:opacity-75 my-4 md:w-3/3">
                <figure class="highcharts-figure">
                    <div id="cont"></div>
                    <!-- JS file link -->
                    <script src="census_interactive/1_Contributor/data.js"></script>
                    <script src="census_interactive/1_Contributor/script.js"></script>
                    <script src="https://blacklabel.github.io/grouped_categories/grouped-categories.js"></script>    
                </figure>
            </a>
            <p class = "px-6 md:w-1/3">Joseph TA highly recommend 10/10</p>
        </article>
    </div>
    
    <!-- Graph 2_Commit -->

    <div id="commit" class="flex flex-col items-center my-10 w-full">
        <a href="#" class="text-3xl flex-col font-bold hover:text-gray-700 pb-4">Commits Python Projects</a>
        
        <article class="flex flex-row shadow w-full md:w-3/3">                 
            <a href="#" class="px-6 hover:opacity-75 my-4 md:w-3/3">
                <figure class="highcharts-figure">
                    <div id="comm"></div> 
                    <!-- JS file link -->
                    <script src="census_interactive/2_Commit/data.js"></script>
                    <script src="census_interactive/2_Commit/script.js"></script>
                    <script src="https://blacklabel.github.io/grouped_categories/grouped-categories.js"></script>    
                </figure>
            </a>
            <p class = "px-6 md:w-1/3">Joseph TA highly recommend 10/10</p>
        </article>
    </div>

    <!-- 3_Project Graph -->

    <div id="project" class="flex flex-col items-center my-10 w-full">
        <a href="#" class="text-3xl flex-col font-bold hover:text-gray-700 pb-4">Active Python Projects</a>
        
        <article class="flex flex-row shadow w-full md:w-3/3">                 
            <a href="#" class="px-6 hover:opacity-75 my-4 md:w-3/3">
                <figure class="highcharts-figure">
                    <div id="proj"></div>
                    <!-- JS file link -->
                    <script src="census_interactive/3_Project/data.js"></script>
                    <script src="census_interactive/3_Project/script.js"></script>
                    <script src="https://blacklabel.github.io/grouped_categories/grouped-categories.js"></script>    
                </figure>
            </a>
            <p class = "px-6 md:w-1/3">Joseph TA highly recommend 8/10</p>
        </article>
    </div>

    <!-- TODO: Move all Java Script functions to JS files -->
    <script>
        function update() {
            var select_lang = document.getElementById('language-select');
            var select_cat = document.getElementById('category-select')
			localStorage.setItem("language", select_lang.options[select_lang.selectedIndex].value);
            localStorage.setItem("category", select_cat.options[select_cat.selectedIndex].value);
        } 

        function showGraphs() {
            var cat = localStorage.getItem("category")
            var lang = localStorage.getItem("language")

            // Ensure that user selects language and category
            if (lang === "") {
                alert('Please select a language');
            }
            else if (cat === "") {
                alert('Please select a category');
            }
            else {
                // Store category

                var cont = document.getElementById("contributor");
                var comm = document.getElementById("commit");
                var proj = document.getElementById("project");
                
                // Update data.js variable for language data
                loadData(lang);

                // Show contributor graph, hide others
                if (cat === "contributor") {
                    comm.style.display = "none";
                    proj.style.display = "none";
                    return cont.style.display = "show";
                }
                // Show commit graph, hide others
                else if (cat === "commit") {
                    proj.style.display = "none";
                    cont.style.display = "none";
                    return comm.style.display = "show";
                }
                // Show project graph, hide others
                else {
                    comm.style.display = "none";
                    cont.style.display = "none";
                    return proj.style.display = "show";
                }
            }
        }
        
        // TODO: Update to use localstorage
        function storedValue() {
            var variableStored = localStorage.getItem("category"); 

            if(variableStored.length > 0){
                document.getElementById("category-select").selected = variableStored;
            } else{}
        }

        // Call to python function to update graph JS data
        function loadData(input) {
            $.ajax({
                type: "POST",
                url: "/run.py",
                data: { param: input },
                success: callbackFunc
            });
        }
        function callbackFunc(response) {
            // do something with the response
            console.log("Data loaded!");
        }

    </script>
</body>
